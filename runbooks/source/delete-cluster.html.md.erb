---
title: Delete a cluster
weight: 55
last_reviewed_on: 2023-11-20
review_in: 6 months
---

# Delete a cluster

This page covers the various available methods for deleting a cloud platform test cluster.

In most cases, it is recommended to pass responsibility for deleting a test cluster off to Concourse. It's easy to make a mistake locally and end up deleting something you shouldn't e.g. switching context to live whilst running a delete cluster in another terminal

## Delete the cluster with Concourse `delete-cluster` pipeline

We have a [dedicated pipeline](https://concourse.cloud-platform.service.justice.gov.uk/teams/main/pipelines/delete-cluster) for deleting test clusters. You can configure and trigger this pipeline
against your test cluster for removal by utilising the associated cloud-platform cli `pipeline delete-cluster` [command](https://github.com/ministryofjustice/cloud-platform-cli/blob/19d33d6618013f0f4047a545b5f0d184d3d2fdfb/pkg/commands/pipeline.go).

In order to use this command, ensure you have the following installed:

- Concourse [fly cli](https://concourse-ci.org/fly.html)
- `wget`

Execute the following command, providing the name of the cluster you wish to delete:

```
cloud-platform pipeline delete-cluster --cluster-name <cluster-name>
```

You'll be prompted to authenticate to Concourse:

```
logging in to team 'main'
navigate to the following URL in your browser:
https://concourse.cloud-platform.service.justice.gov.uk/login?fly_port=12345
```

Once you click the link, `fly` will render the `delete-cluster` pipeline with your cluster name:

```
-       CLUSTER_NAME: ((cluster_name))
+       CLUSTER_NAME: <cluster-name>
```

And will then trigger the job:

```
configuration updated
started delete-cluster/delete #123
```

## Delete the cluster locally, using the cli `cluster delete` command

To delete a cluster:

```
$ export AWS_PROFILE=moj-cp
```

Start from the root directory of a working copy of the [infrastructure repo].

There is a [delete-cluster command] which will handle deleting your cluster.

The command is entirely non-interactive, and will not prompt you to confirm anything. It just destroys things.

### First, run `make tools-shell`

> The delete cluster command must *always* be run in a container. This ensures that the environment of the command is fully controlled, and you don't run into problems such as the kubernetes context being changed in another window, or extra environment variables causing unwanted effects.

Then invoke the command like this:

```
cloud-platform cluster delete --name <cluster-nameto-be-deleted> --dry-run=false
```

Run with `--dry-run=true` to do a dry run (if you don't pass a flag it will default to true), and see what commands would be executed.

You can get more information using:

```
cloud-platform cluster delete --help
```

If any steps fail:

* Fix the underlying problem
* Re-run the command

## Delete an EKS cluster manually

The steps can be found here - [Delete an EKS Cluster]

[infrastructure repo]: https://github.com/ministryofjustice/cloud-platform-infrastructure
[delete-cluster command]: https://github.com/ministryofjustice/cloud-platform-cli/blob/19d33d6618013f0f4047a545b5f0d184d3d2fdfb/pkg/cluster/delete.go
[pipelines repo]: https://github.com/ministryofjustice/cloud-platform-terraform-concourse/tree/main/pipelines/manager/main
[concourse-vars]: https://concourse-ci.org/vars.html#var-syntax
[concourse-static-vars]: https://concourse-ci.org/vars.html#static-vars
[Delete an EKS Cluster]: eks-cluster.html#4-delete-the-eks-cluster
