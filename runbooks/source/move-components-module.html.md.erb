---
title: Moving components modules into core
weight: 60
last_reviewed_on: 2024-04-03
review_in: 6 months
---

# Moving `components` modules into `core`

1. Raise PR with migrated module
2. Update #cloud-platform informing the team about the module migration and to not make new PRs against `cloud-platform-infrastructure`.
3. Pause pipelines
3. Log in to Concourse using `fly -t moj-cp login -c https://concourse.cloud-platform.service.justice.gov.uk/`
3. Ensure your in the `cloud-platform-terraform-concourse` directory.
3. Update pipelines with module name and cluster name:
    `fly -t moj-cp set-pipeline --pipeline migrate-module --config migrate-module.yaml -v cluster_name=$CLUSTER_NAME -v module=$MODULE_NAME`
4. Run `migrate-module` pipeline from the Concourse UI.
5. Unpause pipelines
6. Re-run PR plan - the plan should show "No changes. Your infrastructure matches the configuration."
7. Pause pipelines
8. Get approval for the PR and merge.
9. Un-pause `live-2` and check for a clean apply
10. Repeat 9. with `manager` and `live`
11. Update #cloud-platform informing the team of the completed migration and that pipelines are unpaused.


## Disaster Recovery

If for some reason something goes wrong then you can use the backed up state file to overwrite the remote.

Alternatively all our tf state objects are versioned in S3 so you can restore a previous known working version from the AWS console.
